{% macro render(form, action='', method='POST', cancel_url='') %}
  {% call form_tag(action=action, method=method) %}
    {% for field in form %}
      {{ render_field(form, field.name, field) }}
    {% endfor %}
    {{ buttons(cancel_url=cancel_url) }}
  {% endcall %}
{% endmacro %}

{% macro form_tag(form, action=none, method='POST', use_field_set=true) %}
  <form role="form" action="{{ action or '' }}"
                    method="{{ method }}"
                    class="form-horizontal"
                    enctype="multipart/form-data">
    {% if use_field_set %}
      <fieldset> {{ caller() }} </fieldset>
    {% else %}
       {{ caller() }}
    {% endif %}
  </form>
{% endmacro %}

{% macro render_field(form, name, field, use_label=true) %}
  <div class="form-group">
    {% if use_label %}
      {{ field.label(class='col-md-2 control-label') }}
    {% endif %}
    <div class="col-md-10">
      {{ field(class='form-control input-md', placeholder=name) }}
      <span class="help-block"> {{ field.description }} </span>
      <ul class="input-errors text-danger list-unstyled">
        {% for error in field.errors if error is string %}
          <li> {{ error }} </li>
        {% endfor %}
      </ul>
    </div>
  </div>
{% endmacro %}

{% macro buttons(cancel_url, add_another=true, continue_editing=true, submit_text='Save', type='primary', use_hr=true) %}
  {% if use_hr %}
    <hr>
  {% endif %}
  <div class="col-md-8">
    <div class="col-md-offset-2 col-md-10 submit-row">
      <input type="submit" value="{{ submit_text }}" class="btn btn-{{ type }}" />
      {% if add_another %}
        <input type="submit" value="Save and Add" name="_add_another" class="btn btn-default" />
      {% endif %}
      {% if continue_editing %}
        <input type="submit" value="Save and Continue" name="_continue_editing" class="btn btn-default" />
      {% endif %}
      {% if cancel_url %}
        <a href="{{ url_for(cancel_url) }}" role="button" class="btn btn-danger">Cancel</a>
      {% endif %}
    </div>
  </div>
{% endmacro %}

{% macro render_inline_fields(form, skip=()) %}
  {% for field in form if field.id not in skip %}
    {{ _render_field_inline_form(field) }}
  {% endfor %}
{% endmacro %}

{% macro _render_field_inline_form(field) %}
  <li class="dropdown-form-field">
    {{ field.label(class='control-label') }}
    {{ field(class='form-control input-md', onchange='this.form.submit()') }}
  </li>
{% endmacro %}
