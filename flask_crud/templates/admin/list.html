{% extends "admin/base.html" %}

{# Macros #}
{% import 'admin/macros/head_menu.html' as head_menu %}
{% import 'admin/macros/utils.html' as utils %}
{% import 'admin/macros/table.html' as table %}
{% import 'admin/macros/forms.html' as forms %}
{% import 'admin/macros/pagination.html' as pagination %}

{# Body #}
{% block content %}
  {% call forms.form_tag(filter_form, action='', method='GET') %}
    {% if filter_form._fields %}
      <div class="btn-group pull-right"><!-- Filters -->
        {% if 'search' in filter_form %}
          {{ filter_form.search() }}
        {% endif %}
        {% call utils.dropmenu('Filter by', right=true) %}
          {{ forms.render_inline_fields(filter_form, skip=['search']) }}
        {% endcall %}
      </div><!-- Filters -->
    {% endif %}
  {% endcall %}

  {{ utils.roles_buttons_create(roles) }}

  {% call forms.form_tag(action_form, action='', method='POST', use_field_set=false) %}
    {% if action_form._fields %}
      <div class="btn-group"><!-- Actions -->
        {% call utils.dropmenu('With selected') %}
          {{ forms.render_inline_fields(action_form, skip=['ids']) }}
        {% endcall %}
      </div><!-- Actions -->
    {% endif %}

    {% call table.render(rules.columns, url_generator=url_generator, current=order_by) %}
      {% for item in items %}
      <tr>
        <td> <input type="checkbox" name="ids" value="{{ item.id }}" /> </td>
        <td> {{ utils.roles_buttons(roles, item=item) }} </td>
        {% for rule in rules %}
          {{ rule(item) }}
        {% endfor %}
      </tr>
      {% endfor %}
    {% endcall %}
  {% endcall %}

  {{ pagination.render(page, pages, total, url_generator) }}
{% endblock %}
